package com.olx.service;

import java.time.LocalDate;
import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Predicate;
import javax.persistence.criteria.Root;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.olx.dto.Adv;
import com.olx.entity.AdvEntity;

@Service
public class AdvServiceImpl implements AdvService {

    @Autowired
    EntityManager entityManager;// generated by jpa

    @Override
    public Adv postAdvertise(Adv adv) {
	// TODO Auto-generated method stub
	return null;
    }

    @Override
    public Adv updateAdvertise(Adv adv) {
	// TODO Auto-generated method stub
	return null;
    }

    @Override
    public List<Adv> getAllAdvByUser() {
	// TODO Auto-generated method stub

	return null;
    }

//13.............
    @Override
    public List<Adv> searchAdvertisesByFilterCriteria(String searchText, int categoryId, String postedBy,
	    String dateCondition, LocalDate onDate, LocalDate fromDate, LocalDate toDate, String sortedBy,
	    int startIndex, int records) {
	CriteriaBuilder criteriaBuilder = entityManager.getCriteriaBuilder();
	CriteriaQuery<AdvEntity> criteriaQuery = criteriaBuilder.createQuery(AdvEntity.class);
	Root<AdvEntity> rootEntity = criteriaQuery.from(AdvEntity.class);

	Predicate predicateTitle = criteriaBuilder.and();
	Predicate predicateDesc = criteriaBuilder.and();

	Predicate predicateCatId = criteriaBuilder.and();
	
	Predicate predicateDateCondition = criteriaBuilder.and();


	if (searchText != null && "".equalsIgnoreCase(searchText)) {
	    predicateDesc = criteriaBuilder.like(rootEntity.get("description"), "%" + searchText + "%");

	    predicateTitle = criteriaBuilder.like(rootEntity.get("title"), "%" + searchText + "%");
	}

	if (categoryId != 0 && "".equals(categoryId)) {
	    predicateCatId = criteriaBuilder.like(rootEntity.get("catId"), "%" + categoryId + "%");
	}
	
	if (dateCondition != null && "".equalsIgnoreCasedateCondition)) {
	    predicateCatId = criteriaBuilder.like(rootEntity.get("catId"), "%" + categoryId + "%");
	}

	return null;
    }

    @Override
    public List<Adv> getAdvByUser() {
	// TODO Auto-generated method stub
	return null;
    }

    @Override
    public Adv SearchAdvByText(String searchText) {
	// TODO Auto-generated method stub
	return null;
    }

    @Override
    public Adv returnAdv(int id) {
	// TODO Auto-generated method stub
	return null;
    }

}
